"use strict";const p=require("react/jsx-runtime"),c=require("react"),u=require("./CedrosContext-efFL4kQz.js"),qe=require("@solana/wallet-adapter-react"),xe=require("@solana/wallet-adapter-base"),Xe=require("@solana/wallet-adapter-react-ui");require("@solana/wallet-adapter-wallets");function Ke(t){return!t||!t.coupon_codes?[]:t.coupon_codes.split(",").map(e=>e.trim()).filter(e=>e.length>0)}function Ve(t,e=", "){return t.join(e)}function Ze(t,e){return t<=0?0:(t-e)/t*100}function Je(t,e){if(!e||e.length===0)return t;let n=t,r=0;for(const o of e)if(o.discountType==="percentage"){const s=1-o.discountValue/100;n=n*s}else o.discountType==="fixed"&&(r+=o.discountValue);return n=n-r,n<0&&(n=0),Math.ceil(n*100)/100}function Se(t){const e=Number(t);if(!Number.isFinite(e)||e<=0)return 1;const n=Math.floor(e);return n>0?n:1}function re(t){return t.map(e=>({resource:e.resource,quantity:Se(e.quantity),variantId:e.variantId,metadata:e.metadata}))}function F(t){return t.reduce((e,n)=>e+Se(n.quantity),0)}function et(t){return!!(t&&t.length>0&&(t.length>1||t.length===1&&(t[0].quantity??1)>1))}const tt={invalid_payment_proof:{message:"Payment verification failed",action:"Please try your payment again. If this continues, contact support.",technicalHint:"Invalid payment proof format"},invalid_signature:{message:"Transaction signature is invalid",action:"Please approve the transaction in your wallet and try again.",technicalHint:"Transaction signature verification failed"},invalid_transaction:{message:"Transaction format is invalid",action:"Please try your payment again. If this continues, try updating your wallet app.",technicalHint:"Malformed transaction structure"},transaction_not_found:{message:"Transaction not found on the blockchain",action:"Your transaction may still be processing. Please wait a moment and check your wallet, or try again.",technicalHint:"Transaction signature not found on-chain"},transaction_not_confirmed:{message:"Transaction is still processing",action:"Please wait a moment for the blockchain to confirm your transaction, then try again.",technicalHint:"Transaction not yet confirmed"},transaction_failed:{message:"Transaction failed on the blockchain",action:"Check your wallet for details. You may need to adjust your transaction settings or add more SOL for fees.",technicalHint:"On-chain transaction failure"},transaction_expired:{message:"Transaction took too long to process",action:"Please try your payment again. Consider increasing transaction priority if your wallet supports it.",technicalHint:"Transaction blockhash expired"},invalid_recipient:{message:"Payment was sent to the wrong address",action:"Please try again and ensure you approve the correct transaction in your wallet.",technicalHint:"Recipient address mismatch"},invalid_sender:{message:"Payment sender wallet is invalid",action:"Please reconnect your wallet and try again.",technicalHint:"Sender address validation failed"},unauthorized_refund_issuer:{message:"You are not authorized to issue refunds",action:"Only authorized accounts can process refunds. Please contact support if you believe this is an error.",technicalHint:"Refund issuer not in authorized list"},amount_below_minimum:{message:"Payment amount is too low",action:"Please check the required amount and try again.",technicalHint:"Amount below minimum threshold"},amount_mismatch:{message:"Payment amount does not match the quote",action:"The price may have changed. Please refresh and try your payment again.",technicalHint:"Amount does not match quote"},insufficient_funds_sol:{message:"Not enough SOL for transaction fees",action:"Add at least 0.001 SOL to your wallet to cover network fees, then try again.",technicalHint:"Insufficient SOL balance for fees"},insufficient_funds_token:{message:"Insufficient balance in your wallet",action:"Add more funds to your wallet and try again.",technicalHint:"Insufficient token balance"},invalid_token_mint:{message:"Incorrect payment token",action:"Please pay with the correct token as shown in the payment details.",technicalHint:"Token mint address mismatch"},not_spl_transfer:{message:"Transaction is not a valid token transfer",action:"Please ensure you are sending the correct token type from your wallet.",technicalHint:"Transaction is not an SPL token transfer"},missing_token_account:{message:"Token account not found",action:"Your wallet may need to create a token account first. Try again or use a different wallet.",technicalHint:"Associated token account does not exist"},invalid_token_program:{message:"Invalid token program",action:"Please try your payment again. If this continues, try using a different wallet.",technicalHint:"Token program ID mismatch"},missing_memo:{message:"Payment memo is required but was not included",action:"Please try your payment again and ensure transaction details are approved in your wallet.",technicalHint:"Required memo instruction missing"},invalid_memo:{message:"Payment memo format is invalid",action:"Please try your payment again.",technicalHint:"Memo does not match expected format"},payment_already_used:{message:"This payment has already been processed",action:"Check your transaction history. If you need to make another payment, please start a new transaction.",technicalHint:"Payment signature already recorded"},signature_reused:{message:"Transaction signature has already been used",action:"Please create a new payment transaction.",technicalHint:"Duplicate signature detected"},quote_expired:{message:"Payment quote has expired",action:"Prices are updated frequently. Please refresh and try your payment again.",technicalHint:"Quote timestamp expired"},missing_field:{message:"Required information is missing",action:"Please check all required fields and try again.",technicalHint:"Required field not provided"},invalid_field:{message:"Some information is invalid",action:"Please check your input and try again.",technicalHint:"Field validation failed"},invalid_amount:{message:"Payment amount is invalid",action:"Please check the amount and try again.",technicalHint:"Amount validation failed"},invalid_wallet:{message:"Wallet address is invalid",action:"Please reconnect your wallet and try again.",technicalHint:"Wallet address validation failed"},invalid_resource:{message:"Invalid item selection",action:"Please refresh the page and try again.",technicalHint:"Resource ID validation failed"},invalid_coupon:{message:"Invalid coupon code",action:"Please check the coupon code and try again.",technicalHint:"Coupon code format invalid"},invalid_cart_item:{message:"One or more cart items are invalid",action:"Please review your cart and try again.",technicalHint:"Cart item validation failed"},empty_cart:{message:"Your cart is empty",action:"Please add items to your cart before checking out.",technicalHint:"Cart contains no items"},resource_not_found:{message:"Item not found",action:"This item may no longer be available. Please refresh and try again.",technicalHint:"Resource not found in database"},cart_not_found:{message:"Shopping cart not found",action:"Your cart may have expired. Please start a new order.",technicalHint:"Cart ID not found"},refund_not_found:{message:"Refund not found",action:"Please check your refund reference number or contact support.",technicalHint:"Refund ID not found"},product_not_found:{message:"Product not available",action:"This product may no longer be available. Please browse our current selection.",technicalHint:"Product ID not found"},coupon_not_found:{message:"Coupon code not found",action:"Please check the coupon code or remove it to continue.",technicalHint:"Coupon code not in database"},session_not_found:{message:"Payment session expired",action:"Please start a new payment.",technicalHint:"Session ID not found or expired"},cart_already_paid:{message:"This order has already been paid",action:"Check your order history. If you need to make another purchase, please start a new order.",technicalHint:"Cart marked as paid"},refund_already_processed:{message:"This refund has already been processed",action:"Check your transaction history or contact support for details.",technicalHint:"Refund already completed"},coupon_expired:{message:"Coupon has expired",action:"Please remove the coupon code or use a different code.",technicalHint:"Coupon expiration date passed"},coupon_usage_limit_reached:{message:"Coupon usage limit reached",action:"This coupon has been fully redeemed. Please try a different code.",technicalHint:"Coupon max uses exceeded"},coupon_not_applicable:{message:"Coupon cannot be applied to this purchase",action:"Please check the coupon terms or remove it to continue.",technicalHint:"Coupon conditions not met"},coupon_wrong_payment_method:{message:"Coupon not valid for this payment method",action:"Try a different payment method or remove the coupon code.",technicalHint:"Coupon restricted to specific payment methods"},stripe_error:{message:"Card payment service temporarily unavailable",action:"Please try again in a moment, or use cryptocurrency payment instead.",technicalHint:"Stripe API error"},rpc_error:{message:"Blockchain network temporarily unavailable",action:"Please try again in a moment, or use card payment instead.",technicalHint:"Solana RPC error"},network_error:{message:"Network connection issue",action:"Please check your internet connection and try again.",technicalHint:"Network request failed"},internal_error:{message:"Something went wrong on our end",action:"Please try again. If this continues, contact support.",technicalHint:"Internal server error"},database_error:{message:"Service temporarily unavailable",action:"Please try again in a moment.",technicalHint:"Database operation failed"},config_error:{message:"Service configuration error",action:"Please contact support for assistance.",technicalHint:"Server misconfiguration"}};function oe(t){return tt[t]||{message:"An unexpected error occurred",action:"Please try again or contact support if this continues.",technicalHint:`Unknown error code: ${t}`}}const Ee=new Map,de=new Map,me=new Map,je=200,ge=2e3;function nt(t){const e=me.get(t);return e?Date.now()<e?!0:(me.delete(t),!1):!1}function rt(t,e=je){const n=Date.now()+e;me.set(t,n)}function ot(t,e=ge){const n=Ee.get(t);if(!n)return!1;const o=Date.now()-n;return o<e?(u.getLogger().debug(`[Deduplication] Duplicate request blocked: ${t} (${o}ms ago)`),!0):!1}function st(t){Ee.set(t,Date.now())}function at(t){return de.get(t)||null}function it(t,e){de.set(t,e);const n=()=>{de.delete(t),st(t)};return e.then(n,n),e}async function ct(t,e,n={}){const{windowMs:r=ge,throwOnDuplicate:o=!0}=n,s=at(t);if(s)return u.getLogger().debug(`[Deduplication] Reusing in-flight request: ${t}`),s;if(ot(t,r)){if(o)throw new Error(`Duplicate request blocked: ${t}`);return u.getLogger().warn(`[Deduplication] Duplicate request blocked but not throwing: ${t}`),Promise.reject(new Error("Duplicate request"))}const P=e();return it(t,P)}function se(t,e,n={}){const{cooldownMs:r=je,deduplicationWindowMs:o=ge}=n;return async()=>{if(nt(t)){u.getLogger().debug(`[Deduplication] Button in cooldown: ${t}`);return}rt(t,r);try{await ct(t,async()=>{const s=e();s instanceof Promise&&await s},{windowMs:o,throwOnDuplicate:!1})}catch(s){if(s instanceof Error&&s.message.includes("Duplicate request"))return;throw s}}}function ye(t){return{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:t,opacity:.6,padding:"0.25rem",lineHeight:1}}const O={PAYMENT_START:"cedros:payment:start",WALLET_CONNECT:"cedros:wallet:connect",WALLET_CONNECTED:"cedros:wallet:connected",WALLET_ERROR:"cedros:wallet:error",PAYMENT_PROCESSING:"cedros:payment:processing",PAYMENT_SUCCESS:"cedros:payment:success",PAYMENT_ERROR:"cedros:payment:error"};function Y(t,e){if(typeof window>"u")return;const n=new CustomEvent(t,{detail:e,bubbles:!0,cancelable:!1});window.dispatchEvent(n)}function ae(t,e,n){Y(O.PAYMENT_START,{timestamp:Date.now(),method:t,resource:e,itemCount:n})}function fe(t){Y(O.WALLET_CONNECT,{timestamp:Date.now(),wallet:t})}function Re(t,e){Y(O.WALLET_CONNECTED,{timestamp:Date.now(),wallet:t,publicKey:e})}function ne(t,e){Y(O.WALLET_ERROR,{timestamp:Date.now(),wallet:e,error:t})}function V(t,e,n){Y(O.PAYMENT_PROCESSING,{timestamp:Date.now(),method:t,resource:e,itemCount:n})}function ie(t,e,n,r){Y(O.PAYMENT_SUCCESS,{timestamp:Date.now(),method:t,transactionId:e,resource:n,itemCount:r})}function A(t,e,n,r){Y(O.PAYMENT_ERROR,{timestamp:Date.now(),method:t,error:e,resource:n,itemCount:r})}class $ extends Error{code;retryable;details;httpStatus;constructor(e,n,r=!1,o,s){super(n),this.name="PaymentError",this.code=e,this.retryable=r,this.details=o,this.httpStatus=s,Object.setPrototypeOf(this,$.prototype)}canRetry(){return this.retryable}is(e){return this.code===e}isInCategory(e){return e.includes(this.code)}getUserMessage(){const e=this.getErrorInfo();return e.action?`${e.message} ${e.action}`:e.message}getShortMessage(){return this.getErrorInfo().message}getAction(){return this.getErrorInfo().action}getErrorInfo(){return oe(this.code)}static fromErrorResponse(e,n){const r=e.error.retryable??Te.RETRYABLE.includes(e.error.code);return new $(e.error.code,e.error.message,r,e.error.details,n)}static fromUnknown(e){return e instanceof $?e:e instanceof Error?new $("internal_error",e.message,!1):new $("internal_error",String(e),!1)}}const Te={INSUFFICIENT_FUNDS:["insufficient_funds_sol","insufficient_funds_token"],TRANSACTION_PENDING:["transaction_not_confirmed","transaction_not_found"],VALIDATION:["missing_field","invalid_field","invalid_amount","invalid_wallet","invalid_resource","invalid_cart_item","empty_cart"],COUPON:["invalid_coupon","coupon_not_found","coupon_expired","coupon_usage_limit_reached","coupon_not_applicable","coupon_wrong_payment_method"],RETRYABLE:["transaction_not_confirmed","rpc_error","network_error","stripe_error"],NOT_FOUND:["resource_not_found","cart_not_found","refund_not_found","product_not_found","coupon_not_found","session_not_found","credits_hold_not_found"],CREDITS:["insufficient_credits","credits_hold_expired","credits_hold_not_found"],SECURITY:["invalid_redirect_url","rate_limit_exceeded","nonce_already_used"]};function lt(t){return t instanceof $&&t.canRetry()}function ut(t){return t instanceof $?t.getUserMessage():t instanceof Error?t.message:String(t)}function Le(){const{stripeManager:t}=u.useCedrosContext(),[e,n]=c.useState({status:"idle",error:null,transactionId:null}),r=c.useRef(!1),o=c.useCallback(async(w,q,g,y,l,m)=>{if(r.current)return{success:!1,error:"Payment already in progress"};r.current=!0,n({status:"loading",error:null,transactionId:null});const C={resource:w,successUrl:q,cancelUrl:g,metadata:y,customerEmail:l,couponCode:m};try{const d=await t.processPayment(C);return n({status:d.success?"success":"error",error:d.success?null:d.error||"Payment failed",transactionId:d.success&&d.transactionId||null}),d}catch(d){const T=d instanceof Error?d.message:"Payment failed";return n({status:"error",error:T,transactionId:null}),{success:!1,error:T}}finally{r.current=!1}},[t]),s=c.useCallback(async(w,q,g,y,l,m)=>{if(r.current)return{success:!1,error:"Payment already in progress"};r.current=!0,n({status:"loading",error:null,transactionId:null});const C=re(w);try{const d=await t.processCartCheckout({items:C,successUrl:q,cancelUrl:g,metadata:y,customerEmail:l,couponCode:m});return n({status:d.success?"success":"error",error:d.success?null:d.error||"Cart checkout failed",transactionId:d.success&&d.transactionId||null}),d}catch(d){const T=d instanceof Error?d.message:"Cart checkout failed";return n({status:"error",error:T,transactionId:null}),{success:!1,error:T}}finally{r.current=!1}},[t]),P=c.useCallback(()=>{n({status:"idle",error:null,transactionId:null}),r.current=!1},[]);return{...e,processPayment:o,processCartCheckout:s,reset:P}}function ce(t,e){return c.useMemo(()=>{const n=et(e),r=t||(e?.length===1?e[0].resource:"");return{isCartMode:n,effectiveResource:r}},[t,e])}const dt=(t,e,n)=>{const r=t[e];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((o,s)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==n?". Note that variables only represent file names one level deep.":""))))})},ue=new Map;let te=null;async function Ie(t){if(ue.has(t))return ue.get(t);try{const e=await dt(Object.assign({"./translations/ar.json":()=>Promise.resolve().then(()=>require("./ar-LVoQZTFI.js")),"./translations/bn.json":()=>Promise.resolve().then(()=>require("./bn-BR5Cv1T4.js")),"./translations/de.json":()=>Promise.resolve().then(()=>require("./de-pQxy-oD1.js")),"./translations/en.json":()=>Promise.resolve().then(()=>require("./en-Yikrt96u.js")),"./translations/es.json":()=>Promise.resolve().then(()=>require("./es-D24cg8dD.js")),"./translations/fil.json":()=>Promise.resolve().then(()=>require("./fil-BOBft9G-.js")),"./translations/fr.json":()=>Promise.resolve().then(()=>require("./fr-Ct9ub8Fa.js")),"./translations/he.json":()=>Promise.resolve().then(()=>require("./he-DtQqRKRq.js")),"./translations/id.json":()=>Promise.resolve().then(()=>require("./id-CiM2mL7C.js")),"./translations/in.json":()=>Promise.resolve().then(()=>require("./in-Bzcjmxcc.js")),"./translations/it.json":()=>Promise.resolve().then(()=>require("./it-Blb_pIJl.js")),"./translations/jp.json":()=>Promise.resolve().then(()=>require("./jp-9NHyIuwY.js")),"./translations/kr.json":()=>Promise.resolve().then(()=>require("./kr-DvzJ-0yX.js")),"./translations/ms.json":()=>Promise.resolve().then(()=>require("./ms-BOAu5pUB.js")),"./translations/nl.json":()=>Promise.resolve().then(()=>require("./nl-WHh_DfO8.js")),"./translations/pa.json":()=>Promise.resolve().then(()=>require("./pa-B7kIhZCF.js")),"./translations/pl.json":()=>Promise.resolve().then(()=>require("./pl-H0hBKdvF.js")),"./translations/pt.json":()=>Promise.resolve().then(()=>require("./pt-DwGrViQ3.js")),"./translations/ru.json":()=>Promise.resolve().then(()=>require("./ru-CB2m0UDT.js")),"./translations/ta.json":()=>Promise.resolve().then(()=>require("./ta-CAS197uN.js")),"./translations/th.json":()=>Promise.resolve().then(()=>require("./th-Cpz2cFcg.js")),"./translations/tr.json":()=>Promise.resolve().then(()=>require("./tr-hQrEFk86.js")),"./translations/uk.json":()=>Promise.resolve().then(()=>require("./uk-DrK2Sv8C.js")),"./translations/ur.json":()=>Promise.resolve().then(()=>require("./ur-D5-7mN9a.js")),"./translations/vn.json":()=>Promise.resolve().then(()=>require("./vn-B_iut9YL.js")),"./translations/zh.json":()=>Promise.resolve().then(()=>require("./zh-PR82dCHr.js"))}),`./translations/${t}.json`,3),n=e.default||e;return ue.set(t,n),n}catch{return null}}async function mt(){if(te)return te;const t=Object.assign({"./translations/ar.json":()=>Promise.resolve().then(()=>require("./ar-LVoQZTFI.js")),"./translations/bn.json":()=>Promise.resolve().then(()=>require("./bn-BR5Cv1T4.js")),"./translations/de.json":()=>Promise.resolve().then(()=>require("./de-pQxy-oD1.js")),"./translations/en.json":()=>Promise.resolve().then(()=>require("./en-Yikrt96u.js")),"./translations/es.json":()=>Promise.resolve().then(()=>require("./es-D24cg8dD.js")),"./translations/fil.json":()=>Promise.resolve().then(()=>require("./fil-BOBft9G-.js")),"./translations/fr.json":()=>Promise.resolve().then(()=>require("./fr-Ct9ub8Fa.js")),"./translations/he.json":()=>Promise.resolve().then(()=>require("./he-DtQqRKRq.js")),"./translations/id.json":()=>Promise.resolve().then(()=>require("./id-CiM2mL7C.js")),"./translations/in.json":()=>Promise.resolve().then(()=>require("./in-Bzcjmxcc.js")),"./translations/it.json":()=>Promise.resolve().then(()=>require("./it-Blb_pIJl.js")),"./translations/jp.json":()=>Promise.resolve().then(()=>require("./jp-9NHyIuwY.js")),"./translations/kr.json":()=>Promise.resolve().then(()=>require("./kr-DvzJ-0yX.js")),"./translations/ms.json":()=>Promise.resolve().then(()=>require("./ms-BOAu5pUB.js")),"./translations/nl.json":()=>Promise.resolve().then(()=>require("./nl-WHh_DfO8.js")),"./translations/pa.json":()=>Promise.resolve().then(()=>require("./pa-B7kIhZCF.js")),"./translations/pl.json":()=>Promise.resolve().then(()=>require("./pl-H0hBKdvF.js")),"./translations/pt.json":()=>Promise.resolve().then(()=>require("./pt-DwGrViQ3.js")),"./translations/ru.json":()=>Promise.resolve().then(()=>require("./ru-CB2m0UDT.js")),"./translations/ta.json":()=>Promise.resolve().then(()=>require("./ta-CAS197uN.js")),"./translations/th.json":()=>Promise.resolve().then(()=>require("./th-Cpz2cFcg.js")),"./translations/tr.json":()=>Promise.resolve().then(()=>require("./tr-hQrEFk86.js")),"./translations/uk.json":()=>Promise.resolve().then(()=>require("./uk-DrK2Sv8C.js")),"./translations/ur.json":()=>Promise.resolve().then(()=>require("./ur-D5-7mN9a.js")),"./translations/vn.json":()=>Promise.resolve().then(()=>require("./vn-B_iut9YL.js")),"./translations/zh.json":()=>Promise.resolve().then(()=>require("./zh-PR82dCHr.js"))}),e=[];for(const n in t){const r=n.match(/\.\/translations\/([a-z]{2,3}(?:-[A-Z]{2})?)\.json$/);r&&e.push(r[1])}return te=e.length>0?e:["en"],te}function De(){return typeof navigator>"u"?"en":(navigator.language||navigator.userLanguage||"en").split("-")[0].toLowerCase()}async function Me(t){let e=await Ie(t);if(e||(e=await Ie("en"),e))return e;throw new Error("Critical: No translation files found, not even en.json")}function Be(t){return(e,n)=>{const r=e.split(".");let o=t;for(const s of r)if(o&&typeof o=="object"&&s in o)o=o[s];else return e;return typeof o!="string"?e:n?Object.entries(n).reduce((s,[P,w])=>s.replace(new RegExp(`\\{${P}\\}`,"g"),w),o):o}}function ft(t,e,n=!0){const r=e.errors[t];if(!r){const o=oe(t);return n&&o.action?`${o.message} ${o.action}`:o.message}return n&&r.action?`${r.message} ${r.action}`:r.message}function Z(t){const[e,n]=c.useState(null),[r,o]=c.useState(!0),s=c.useMemo(()=>t||De(),[t]);return c.useEffect(()=>{let w=!1;return(async()=>{o(!0);try{const g=await Me(s);w||(n(g),o(!1))}catch(g){console.error("[CedrosPay] Failed to load translations:",g),w||o(!1)}})(),()=>{w=!0}},[s]),{t:c.useMemo(()=>e?Be(e):w=>({"ui.purchase":"Purchase","ui.pay_with_card":"Pay with Card","ui.pay_with_crypto":"Pay with USDC","ui.pay_with_usdc":"Pay with USDC","ui.card":"Card","ui.usdc_solana":"USDC (Solana)","ui.crypto":"Crypto","ui.processing":"Processing...","ui.loading":"Loading...","ui.connect_wallet":"Connect Wallet","ui.connecting":"Connecting..."})[w]||w,[e]),locale:s,isLoading:r,translations:e}}function gt(t,e=!0){const{translations:n}=Z();if(!n){const o=oe(t);return e&&o.action?`${o.message} ${o.action}`:o.message}const r=n.errors[t];if(!r){const o=oe(t);return e&&o.action?`${o.message} ${o.action}`:o.message}return e&&r.action?`${r.message} ${r.action}`:r.message}function Ne({resource:t,items:e,successUrl:n,cancelUrl:r,metadata:o,customerEmail:s,couponCode:P,label:w,disabled:q=!1,onAttempt:g,onSuccess:y,onError:l,className:m=""}){const{status:C,error:d,transactionId:T,processPayment:E,processCartCheckout:f}=Le(),a=u.useCedrosTheme(),{isCartMode:b,effectiveResource:_}=ce(t,e),{t:v,translations:k}=Z(),M=w||v("ui.pay_with_card"),B=a.unstyled?m:`${a.className} cedros-theme__stripe-button ${m}`.trim(),h=d&&typeof d!="string"?d?.code??null:null,x=d?typeof d=="string"?d:(D=>{if(!D||!k)return"";const R=k.errors[D];return R?R.action?`${R.message} ${R.action}`:R.message:""})(h):null,I=c.useCallback(async()=>{u.getLogger().debug("[StripeButton] executePayment with couponCode:",P);const D=b&&e?F(e):void 0;if(ae("stripe",_,D),g&&g("stripe"),!b&&!_){const Q="Invalid payment configuration: missing resource or items";u.getLogger().error("[StripeButton]",Q),A("stripe",Q,_,D),l&&l(Q);return}let R;V("stripe",_,D),b&&e?(u.getLogger().debug("[StripeButton] Processing cart checkout with coupon:",P),R=await f(e,n,r,o,s,P)):_&&(u.getLogger().debug("[StripeButton] Processing single payment with coupon:",P),R=await E(_,n,r,o,s,P)),R&&R.success&&R.transactionId?(ie("stripe",R.transactionId,_,D),y&&y(R.transactionId)):R&&!R.success&&R.error&&(A("stripe",R.error,_,D),l&&l(R.error))},[P,b,_,e,n,r,o,s,f,E,g,y,l]),H=c.useMemo(()=>b&&e?`stripe-cart-${e.map(D=>D.resource).join("-")}`:`stripe-${_||"unknown"}`,[b,e,_]),U=c.useMemo(()=>se(H,I),[H,I]),N=C==="loading",j=q||N;return p.jsxs("div",{className:B,style:a.unstyled?{}:a.style,children:[p.jsx("button",{onClick:U,disabled:j,className:a.unstyled?m:"cedros-theme__button cedros-theme__stripe",type:"button",children:N?v("ui.processing"):M}),x&&p.jsx("div",{className:a.unstyled?"":"cedros-theme__error",children:x}),T&&p.jsx("div",{className:a.unstyled?"":"cedros-theme__success",children:v("ui.payment_successful")})]})}function He(){const{x402Manager:t,walletManager:e}=u.useCedrosContext(),{publicKey:n,signTransaction:r}=qe.useWallet(),[o,s]=c.useState({status:"idle",error:null,transactionId:null}),[P,w]=c.useState(null),[q,g]=c.useState(null),y=c.useRef(!1),l=c.useCallback(()=>{if(!n){const f="Wallet not connected";return s({status:"error",error:f,transactionId:null}),{valid:!1,error:f}}if(!r){const f="Wallet does not support signing";return s({status:"error",error:f,transactionId:null}),{valid:!1,error:f}}return{valid:!0}},[n,r]),m=c.useCallback(async f=>{try{s(b=>({...b,status:"loading"}));const a=await t.requestQuote({resource:f});if(!t.validateRequirement(a))throw new Error("Invalid requirement received from server");return w(a),s(b=>({...b,status:"idle"})),a}catch(a){const b=u.formatError(a,"Failed to fetch requirement");throw s({status:"error",error:b,transactionId:null}),a}},[t]),C=c.useCallback(async(f,a,b,_,v="regular")=>{if(!!f.extra?.feePayer){console.log("âš¡ [useX402Payment] GASLESS FLOW - Backend pays fees"),console.log("ðŸ”¨ [useX402Payment] Requesting backend to build gasless transaction");const{transaction:M,blockhash:B}=await t.buildGaslessTransaction({resourceId:a,userWallet:n.toString(),feePayer:f.extra.feePayer,couponCode:b});console.log("ðŸ“¦ [useX402Payment] Deserializing transaction from backend");const h=e.deserializeTransaction(M);console.log("âœï¸ [useX402Payment] Requesting wallet to partially sign (transfer authority only)");const L=await e.partiallySignTransaction({transaction:h,signTransaction:r,blockhash:B});console.log("ðŸ“¤ [useX402Payment] Submitting partially-signed transaction to backend");const x=await t.submitGaslessTransaction({resource:a,partialTx:L,couponCode:b,metadata:_,resourceType:v,requirement:f});return x.success&&x.settlement&&g(x.settlement),x}else{const M=await e.buildTransaction({requirement:f,payerPublicKey:n}),B=await e.signTransaction({transaction:M,signTransaction:r}),h=e.buildPaymentPayload({requirement:f,signedTx:B,payerPublicKey:n}),L=await t.submitPayment({resource:a,payload:h,couponCode:b,metadata:_,resourceType:v});return L.success&&L.settlement&&g(L.settlement),L}},[n,r,t,e]),d=c.useCallback(async(f,a,b)=>{if(y.current)return{success:!1,error:"Payment already in progress"};const _=l();if(!_.valid)return{success:!1,error:_.error};y.current=!0,s({status:"loading",error:null,transactionId:null});try{console.log("ðŸ” [useX402Payment] Fetching fresh quote for resource:",f);const v=await t.requestQuote({resource:f,couponCode:a});console.log("âœ… [useX402Payment] Got quote:",{payTo:v.payTo,amount:v.maxAmountRequired}),w(v),console.log("âš™ï¸ [useX402Payment] Executing payment flow with fresh requirement");const k=await C(v,f,a,b,"regular");return k.success?s({status:"success",error:null,transactionId:k.transactionId||"payment-success"}):s({status:"error",error:k.error||"Payment failed",transactionId:null}),k}catch(v){const k=u.formatError(v,"Payment failed");return s({status:"error",error:k,transactionId:null}),{success:!1,error:k}}finally{y.current=!1}},[l,t,C]),T=c.useCallback(async(f,a,b)=>{if(y.current)return{success:!1,error:"Payment already in progress"};const _=l();if(!_.valid)return{success:!1,error:_.error};y.current=!0,s({status:"loading",error:null,transactionId:null});try{const v=re(f),k=await t.requestCartQuote({items:v,metadata:a,couponCode:b}),M=k.cartId,B=k.quote;if(!t.validateRequirement(B))throw new Error("Invalid cart quote received from server");w(B);const h=await C(B,M,b,a,"cart");return h.success?s({status:"success",error:null,transactionId:h.transactionId||"cart-payment-success"}):s({status:"error",error:h.error||"Cart payment failed",transactionId:null}),h}catch(v){const k=u.formatError(v,"Cart payment failed");return s({status:"error",error:k,transactionId:null}),{success:!1,error:k}}finally{y.current=!1}},[l,t,C]),E=c.useCallback(()=>{s({status:"idle",error:null,transactionId:null}),w(null),g(null),y.current=!1},[]);return{...o,requirement:P,settlement:q,fetchQuote:m,processPayment:d,processCartPayment:T,reset:E}}function We({resource:t,items:e,label:n,disabled:r=!1,onAttempt:o,onSuccess:s,onError:P,className:w="",testPageUrl:q,hideMessages:g=!1,metadata:y,couponCode:l}){const{connected:m,connecting:C,connect:d,disconnect:T,select:E,wallets:f,wallet:a,publicKey:b}=qe.useWallet(),{status:_,error:v,transactionId:k,processPayment:M,processCartPayment:B}=He(),h=u.useCedrosTheme(),{solanaError:L}=u.useCedrosContext(),{isCartMode:x,effectiveResource:I}=ce(t,e),{t:H,translations:U}=Z(),N=n||H("ui.pay_with_crypto"),j=v&&typeof v!="string"?v?.code??null:null,D=L&&typeof L!="string"?L?.code??null:null,R=i=>{if(!i||!U)return"";const S=U.errors[i];return S?S.action?`${S.message} ${S.action}`:S.message:""},Q=v?typeof v=="string"?v:R(j):null,pe=L?typeof L=="string"?L:R(D):null,he=c.useRef(M),we=c.useRef(B);c.useEffect(()=>{he.current=M,we.current=B},[M,B]);const Oe=c.useMemo(()=>f.map(i=>`${i.adapter.name}-${i.readyState}`).join(","),[f]),J=c.useMemo(()=>f.filter(({readyState:i})=>i===xe.WalletReadyState.Installed||i===xe.WalletReadyState.Loadable),[Oe]);c.useEffect(()=>{if(_==="success"&&k){const i=x&&e?F(e):void 0;ie("crypto",k,I,i),s&&s(k)}},[_,k,s,x,e,I]),c.useEffect(()=>{if(_==="error"&&v){const i=x&&e?F(e):void 0;A("crypto",v,I,i),P&&P(v)}},[_,v,P,x,e,I]);const Ce=typeof window<"u"&&window.top!==window.self,[Pe,G]=c.useState(!1),[be,le]=c.useState(!1),[X,z]=c.useState(null),K=L;c.useEffect(()=>{let i=!1;return i||(async()=>{if(be&&a&&!m&&!C){u.getLogger().debug("[CryptoButton] Wallet detected, attempting auto-connect:",a.adapter.name),le(!1),fe(a.adapter.name);try{await d(),i||u.getLogger().debug("[CryptoButton] Auto-connect successful")}catch(W){if(!i){u.getLogger().error("[CryptoButton] Auto-connect failed:",W);const ee=W instanceof Error?W.message:"Failed to connect wallet";ne(ee,a.adapter.name),z(null)}}}})(),()=>{i=!0}},[a,be,m,C,d]),c.useEffect(()=>{if(u.getLogger().debug("[CryptoButton] Payment useEffect triggered",{connected:m,hasPendingPayment:!!X,hasPublicKey:!!b,pendingPaymentType:X?.type}),m&&X&&b&&a){Re(a.adapter.name,b.toString()),u.getLogger().debug("[CryptoButton] All conditions met! Processing pending payment:",X);const i=X;z(null),G(!1);const S=i.type==="cart"&&i.items?F(i.items):void 0;V("crypto",i.resource,S),i.type==="cart"&&i.items?(u.getLogger().debug("[CryptoButton] Auto-processing cart payment"),we.current(i.items,i.metadata,i.couponCode)):i.type==="single"&&i.resource&&(u.getLogger().debug("[CryptoButton] Auto-processing single payment"),he.current(i.resource,i.couponCode,i.metadata))}},[m,X,b,a]);const ve=c.useCallback(async()=>{u.getLogger().debug("[CryptoButton] executePaymentFlow called",{connected:m,wallet:a?.adapter.name,couponCode:l,isCartMode:x,hasItems:!!e,effectiveResource:I});const i=x&&e?F(e):void 0;if(ae("crypto",I,i),o&&o("crypto"),K){u.getLogger().error("[CryptoButton] Solana dependencies missing:",K),A("crypto",K,I,i),P&&P(K);return}if(Ce){const S=q||window.location.href;try{if(new URL(S,window.location.origin).origin!==window.location.origin)throw u.getLogger().error("[CryptoButton] Blocked attempt to open external URL:",S),new Error("Cannot open external URLs from embedded context");window.open(S,"_blank","noopener,noreferrer")}catch(W){throw u.getLogger().error("[CryptoButton] URL validation failed:",W),W}return}if(m)V("crypto",I,i),x&&e?(u.getLogger().debug("[CryptoButton] Processing cart payment with coupon:",l),await B(e,y,l)):I&&(u.getLogger().debug("[CryptoButton] Processing single payment with coupon:",l),await M(I,l,y));else{let S=!1;if(x&&e?(u.getLogger().debug("[CryptoButton] Setting pending cart payment with coupon:",l),z({type:"cart",items:e,metadata:y,couponCode:l}),S=!0):I&&(u.getLogger().debug("[CryptoButton] Setting pending single payment with coupon:",l),z({type:"single",resource:I,metadata:y,couponCode:l}),S=!0),!S){u.getLogger().error("[CryptoButton] No valid payment to process");return}try{if(a)u.getLogger().debug("[CryptoButton] Wallet already selected, connecting:",a.adapter.name),fe(a.adapter.name),await d();else{if(u.getLogger().debug("[CryptoButton] No wallet selected, showing selector. Available wallets:",J.map(W=>W.adapter.name)),J.length===0){z(null);const W="No wallets available";throw ne(W),new Error(W)}G(!0)}}catch(W){z(null);const ee=W instanceof Error?W.message:"Failed to connect wallet";u.getLogger().error("[CryptoButton] Connection error:",ee),ne(ee,a?.adapter.name)}}},[m,a,l,x,e,I,Ce,q,J,d,y,B,M,K,o,P]),_e=c.useMemo(()=>x&&e?`crypto-cart-${e.map(i=>i.resource).join("-")}`:`crypto-${I||"unknown"}`,[x,e,I]),ze=c.useMemo(()=>se(_e,ve,{cooldownMs:200,deduplicationWindowMs:0}),[_e,ve]),ke=_==="loading",Fe=r||ke||C||!!K,Ye=ke?H("ui.processing"):N,Ue=c.useCallback(async()=>{try{le(!1),m&&await T(),E(null),G(!0)}catch(i){u.getLogger().error("Failed to change wallet:",i)}},[m,T,E]),Qe=c.useCallback(i=>{u.getLogger().debug("[CryptoButton] Wallet clicked:",i),G(!1),E(i),le(!0),u.getLogger().debug("[CryptoButton] Wallet selected, useEffect will auto-connect")},[E]),Ge=c.useCallback(async()=>{try{if(await T(),z(null),typeof window<"u"&&window.localStorage)try{window.localStorage.removeItem("walletName")}catch(i){i instanceof Error&&i.name==="QuotaExceededError"?u.getLogger().warn("localStorage quota exceeded when removing wallet preference"):u.getLogger().error("Failed to clear wallet preference from localStorage:",i)}}catch(i){u.getLogger().error("Failed to disconnect wallet:",i)}},[T]);return p.jsxs("div",{className:h.unstyled?w:`${h.className} cedros-theme__crypto-button ${w||""}`,style:h.unstyled?{}:h.style,children:[p.jsx("button",{onClick:ze,disabled:Fe,className:h.unstyled?w:"cedros-theme__button cedros-theme__crypto",type:"button",children:Ye}),Pe&&!g&&p.jsx("div",{className:"cedros-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:h.tokens.modalOverlay,display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"1rem"},onClick:()=>G(!1),children:p.jsxs("div",{className:"cedros-modal-content",style:{backgroundColor:h.tokens.modalBackground,borderRadius:"12px",padding:"2rem",maxWidth:"400px",width:"100%",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",border:`1px solid ${h.tokens.modalBorder}`},onClick:i=>i.stopPropagation(),children:[p.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[p.jsx("h3",{style:{margin:0,fontSize:"1.25rem",fontWeight:600,color:h.tokens.surfaceText},children:H("wallet.select_wallet")}),p.jsx("button",{onClick:()=>G(!1),style:ye(h.tokens.surfaceText),"aria-label":"Close modal",type:"button",children:"Ã—"})]}),p.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:J.map(i=>p.jsxs("button",{onClick:()=>Qe(i.adapter.name),style:{width:"100%",padding:"1rem",backgroundColor:h.tokens.surfaceBackground,border:`1px solid ${h.tokens.surfaceBorder}`,borderRadius:"0.5rem",cursor:"pointer",fontSize:"1rem",textAlign:"left",color:h.tokens.surfaceText,display:"flex",alignItems:"center",gap:"1rem",transition:"all 0.2s ease"},onMouseEnter:S=>{S.currentTarget.style.backgroundColor=h.tokens.modalBackground,S.currentTarget.style.borderColor=h.tokens.surfaceText,S.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:S=>{S.currentTarget.style.backgroundColor=h.tokens.surfaceBackground,S.currentTarget.style.borderColor=h.tokens.surfaceBorder,S.currentTarget.style.transform="translateY(0)"},type:"button",children:[p.jsx(Xe.WalletIcon,{wallet:i,style:{width:"24px",height:"24px"}}),p.jsx("span",{style:{fontWeight:500},children:i.adapter.name})]},i.adapter.name))})]})}),m&&!g&&!Pe&&p.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"0.5rem",fontSize:"0.75rem",color:h.tokens.surfaceText,opacity:.7},children:[p.jsx("button",{onClick:Ue,style:{background:"none",border:"none",padding:0,color:"inherit",textDecoration:"none",cursor:"pointer",fontSize:"inherit"},type:"button",children:"Change Wallet"}),p.jsx("button",{onClick:Ge,style:{background:"none",border:"none",padding:0,color:"inherit",textDecoration:"none",cursor:"pointer",fontSize:"inherit"},type:"button",children:H("ui.disconnect")})]}),!g&&pe&&p.jsx("div",{className:h.unstyled?"":"cedros-theme__error",children:pe}),!g&&Q&&p.jsx("div",{className:h.unstyled?"":"cedros-theme__error",children:Q}),!g&&k&&p.jsx("div",{className:h.unstyled?"":"cedros-theme__success",children:H("ui.payment_successful")})]})}function $e(){const{creditsManager:t}=u.useCedrosContext(),[e,n]=c.useState({status:"idle",error:null,transactionId:null,requirement:null,holdId:null}),r=c.useRef(!1),o=c.useCallback(async(g,y)=>{n(l=>({...l,status:"loading",error:null}));try{const l=await t.requestQuote(g,y);return n(m=>({...m,status:"idle",requirement:l})),l}catch(l){const m=l instanceof Error?l.message:"Failed to fetch credits quote";return n(C=>({...C,status:"error",error:m})),null}},[t]),s=c.useCallback(async(g,y)=>{n(l=>({...l,status:"loading",error:null}));try{const l=re(g),m=await t.requestCartQuote(l,y);return n(C=>({...C,status:"idle"})),m}catch(l){const m=l instanceof Error?l.message:"Failed to fetch cart credits quote";return n(C=>({...C,status:"error",error:m})),null}},[t]),P=c.useCallback(async(g,y,l,m)=>{if(r.current)return{success:!1,error:"Payment already in progress"};r.current=!0,n({status:"loading",error:null,transactionId:null,requirement:null,holdId:null});try{const C=await t.processPayment(g,y,l,m);return n({status:C.success?"success":"error",error:C.success?null:C.error||"Credits payment failed",transactionId:C.success&&C.transactionId||null,requirement:null,holdId:null}),C}finally{r.current=!1}},[t]),w=c.useCallback(async(g,y,l,m)=>{if(r.current)return{success:!1,error:"Payment already in progress"};r.current=!0,n({status:"loading",error:null,transactionId:null,requirement:null,holdId:null});try{const C=re(g),d=await t.requestCartQuote(C,l);if(!d)return n({status:"error",error:"Credits payment not available for this cart",transactionId:null,requirement:null,holdId:null}),{success:!1,error:"Credits payment not available"};const E=(await t.createCartHold({cartId:d.cartId,authToken:y})).holdId;n(a=>({...a,holdId:E}));const f=await t.authorizeCartPayment({cartId:d.cartId,holdId:E,authToken:y,metadata:m});return n({status:f.success?"success":"error",error:f.success?null:f.error||"Cart credits payment failed",transactionId:f.success&&f.transactionId||null,requirement:null,holdId:null}),{success:f.success,transactionId:f.transactionId,error:f.error}}catch(C){const d=C instanceof Error?C.message:"Cart credits payment failed";return n({status:"error",error:d,transactionId:null,requirement:null,holdId:null}),{success:!1,error:d}}finally{r.current=!1}},[t]),q=c.useCallback(()=>{n({status:"idle",error:null,transactionId:null,requirement:null,holdId:null}),r.current=!1},[]);return{...e,fetchQuote:o,fetchCartQuote:s,processPayment:P,processCartPayment:w,reset:q}}function Ae({resource:t,items:e,authToken:n,metadata:r,couponCode:o,label:s,disabled:P=!1,onAttempt:w,onSuccess:q,onError:g,className:y=""}){const{status:l,error:m,transactionId:C,processPayment:d,processCartPayment:T}=$e(),E=u.useCedrosTheme(),{isCartMode:f,effectiveResource:a}=ce(t,e),{t:b,translations:_}=Z(),v=s||b("ui.pay_with_credits")||"Pay with Credits",k=E.unstyled?y:`${E.className} cedros-theme__credits-button ${y}`.trim(),M=m&&typeof m!="string"?m?.code??null:null,h=m?typeof m=="string"?m:(N=>{if(!N||!_)return"";const j=_.errors[N];return j?j.action?`${j.message} ${j.action}`:j.message:""})(M):null,L=c.useCallback(async()=>{u.getLogger().debug("[CreditsButton] executePayment");const N=f&&e?F(e):void 0;if(ae("credits",a,N),w&&w("credits"),!n){const D="Authentication required: please log in to pay with credits";u.getLogger().error("[CreditsButton]",D),A("credits",D,a,N),g&&g(D);return}if(!f&&!a){const D="Invalid payment configuration: missing resource";u.getLogger().error("[CreditsButton]",D),A("credits",D,a,N),g&&g(D);return}let j;V("credits",a,N),f&&e?(u.getLogger().debug("[CreditsButton] Processing cart checkout"),j=await T(e,n,o,r)):a&&(u.getLogger().debug("[CreditsButton] Processing single payment"),j=await d(a,n,o,r)),j&&j.success&&j.transactionId?(ie("credits",j.transactionId,a,N),q&&q(j.transactionId)):j&&!j.success&&j.error&&(A("credits",j.error,a,N),g&&g(j.error))},[n,f,a,e,o,r,d,T,w,q,g]),x=c.useMemo(()=>f&&e?`credits-cart-${e.map(N=>N.resource).join("-")}`:`credits-${a||"unknown"}`,[f,e,a]),I=c.useMemo(()=>se(x,L),[x,L]),H=l==="loading",U=P||H;return p.jsxs("div",{className:k,style:E.unstyled?{}:E.style,children:[p.jsx("button",{onClick:I,disabled:U,className:E.unstyled?y:"cedros-theme__button cedros-theme__credits",type:"button",children:H?b("ui.processing"):v}),h&&p.jsx("div",{className:E.unstyled?"":"cedros-theme__error",children:h}),C&&p.jsx("div",{className:E.unstyled?"":"cedros-theme__success",children:b("ui.payment_successful")})]})}const yt=({isOpen:t,onClose:e,resource:n,items:r,cardLabel:o="Card",cryptoLabel:s="USDC (Solana)",creditsLabel:P="Pay with Credits",showCard:w=!0,showCrypto:q=!0,showCredits:g=!1,onPaymentAttempt:y,onPaymentSuccess:l,onPaymentError:m,onStripeSuccess:C,onCryptoSuccess:d,onCreditsSuccess:T,onStripeError:E,onCryptoError:f,onCreditsError:a,customerEmail:b,successUrl:_,cancelUrl:v,metadata:k,couponCode:M,authToken:B,testPageUrl:h,hideMessages:L=!1})=>{const{tokens:x}=u.useCedrosTheme();return c.useEffect(()=>{const I=H=>{H.key==="Escape"&&t&&e()};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[t,e]),c.useEffect(()=>{if(t){const I=window.scrollY;return document.body.style.position="fixed",document.body.style.top=`-${I}px`,document.body.style.width="100%",document.body.style.overflowY="scroll",()=>{const H=document.body.style.top?Math.abs(parseInt(document.body.style.top.replace("px",""),10)):0;document.body.style.position="",document.body.style.top="",document.body.style.width="",document.body.style.overflowY="",window.scrollTo(0,H)}}},[t]),t?p.jsx("div",{className:"cedros-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:x.modalOverlay,display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"1rem"},onClick:e,children:p.jsxs("div",{className:"cedros-modal-content",style:{backgroundColor:x.modalBackground,borderRadius:"12px",padding:"2rem",maxWidth:"400px",width:"100%",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",border:`1px solid ${x.modalBorder}`},onClick:I=>I.stopPropagation(),children:[p.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[p.jsx("h3",{style:{margin:0,fontSize:"1.25rem",fontWeight:600,color:x.surfaceText},children:"Choose Payment Method"}),p.jsx("button",{onClick:e,style:ye(x.surfaceText),"aria-label":"Close modal",children:"Ã—"})]}),p.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[w&&p.jsx(Ne,{resource:n,items:r,label:o,onAttempt:y,onSuccess:C||l,onError:E||m,customerEmail:b,successUrl:_,cancelUrl:v,metadata:k,couponCode:M}),q&&p.jsx(We,{resource:n,items:r,label:s,onAttempt:y,onSuccess:d||l,onError:f||m,testPageUrl:h,hideMessages:L,metadata:k,couponCode:M}),g&&p.jsx(Ae,{resource:n,items:r,label:P,authToken:B,onAttempt:y?()=>y("credits"):void 0,onSuccess:T||l,onError:a||m,metadata:k,couponCode:M})]})]})}):null};function pt({product:t,paymentMethod:e,showOriginalPrice:n=!1,className:r="",style:o={}}){const s=e==="stripe",P=s?t.fiatAmount:t.cryptoAmount,w=s?t.effectiveFiatAmount:t.effectiveCryptoAmount,q=s?t.fiatCurrency.toUpperCase():t.cryptoToken,g=s?t.hasStripeCoupon:t.hasCryptoCoupon,y=s?t.stripeDiscountPercent:t.cryptoDiscountPercent;return p.jsxs("div",{className:r,style:o,children:[n&&g&&p.jsxs("span",{style:{textDecoration:"line-through",opacity:.6,marginRight:"0.5rem",fontSize:"0.875em"},children:[P.toFixed(2)," ",q]}),p.jsxs("span",{style:{fontWeight:600},children:[w.toFixed(2)," ",q]}),g&&y>0&&p.jsxs("span",{style:{marginLeft:"0.5rem",padding:"0.125rem 0.375rem",backgroundColor:"#10b981",color:"white",borderRadius:"0.25rem",fontSize:"0.75em",fontWeight:600},children:[y,"% OFF"]})]})}function ht({product:t,paymentMethod:e,className:n="",style:r={}}){const o=e==="stripe",s=o?t.hasStripeCoupon:t.hasCryptoCoupon,P=o?t.stripeDiscountPercent:t.cryptoDiscountPercent,w=o?t.stripeCouponCode:t.cryptoCouponCode;if(!s||P===0)return null;const q=o?`${P}% off with card!`:`${P}% off with crypto!`;return p.jsxs("div",{className:n,style:{display:"inline-flex",alignItems:"center",padding:"0.5rem 0.75rem",backgroundColor:o?"#6366f1":"#10b981",color:"white",borderRadius:"0.375rem",fontSize:"0.875rem",fontWeight:600,...r},children:[q,w&&p.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.8,fontSize:"0.75em",fontWeight:400},children:["(",w,")"]})]})}exports.CEDROS_EVENTS=O;exports.CreditsButton=Ae;exports.CryptoButton=We;exports.ERROR_CATEGORIES=Te;exports.PaymentMethodBadge=ht;exports.PaymentModal=yt;exports.ProductPrice=pt;exports.StripeButton=Ne;exports.calculateDiscountPercentage=Ze;exports.createDedupedClickHandler=se;exports.createTranslator=Be;exports.detectLocale=De;exports.emitPaymentError=A;exports.emitPaymentProcessing=V;exports.emitPaymentStart=ae;exports.emitPaymentSuccess=ie;exports.emitWalletConnect=fe;exports.emitWalletConnected=Re;exports.emitWalletError=ne;exports.formatCouponCodes=Ve;exports.getAvailableLocales=mt;exports.getCartItemCount=F;exports.getLocalizedError=ft;exports.getModalCloseButtonStyles=ye;exports.getUserErrorMessage=ut;exports.isRetryableError=lt;exports.loadLocale=Me;exports.parseCouponCodes=Ke;exports.stackCheckoutCoupons=Je;exports.useCreditsPayment=$e;exports.useLocalizedError=gt;exports.usePaymentMode=ce;exports.useStripeCheckout=Le;exports.useTranslation=Z;exports.useX402Payment=He;
