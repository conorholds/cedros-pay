"use strict";const e=require("react");function g({data:n,onSave:a,debounceMs:i=1500,savedDurationMs:l=2e3,enabled:o=!0,skipInitial:f=!0}){const[R,t]=e.useState("idle"),[d,s]=e.useState(null),m=e.useRef(!0),r=e.useRef(null),u=e.useRef(null),T=e.useRef(n);T.current=n;const c=e.useCallback(async()=>{t("saving"),s(null);try{await a(T.current),t("saved"),u.current=setTimeout(()=>{t("idle")},l)}catch(v){t("error"),s(v instanceof Error?v.message:"Save failed")}},[a,l]),E=e.useCallback(async()=>{r.current&&(clearTimeout(r.current),r.current=null),await c()},[c]),S=e.useCallback(()=>{t("idle"),s(null)},[]);return e.useEffect(()=>{if(o){if(f&&m.current){m.current=!1;return}return r.current&&clearTimeout(r.current),u.current&&clearTimeout(u.current),t("pending"),r.current=setTimeout(()=>{c()},i),()=>{r.current&&clearTimeout(r.current)}}},[n,o,f,i,c]),e.useEffect(()=>()=>{r.current&&clearTimeout(r.current),u.current&&clearTimeout(u.current)},[]),{status:R,error:d,saveNow:E,reset:S}}exports.useAutosave=g;
